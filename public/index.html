<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíà</text></svg>">

    <!-- SEO Meta Tags -->
    <meta name="description" id="metaDescription" content="">
    <meta name="keywords" id="metaKeywords" content="">
    <meta name="author" id="metaAuthor" content="">
    <meta name="robots" content="index, follow">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" id="ogTitle" content="">
    <meta property="og:description" id="ogDescription" content="">
    <meta property="og:image" id="ogImage" content="">
    <meta property="og:url" id="ogUrl" content="">
    <meta property="og:site_name" id="ogSiteName" content="">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" id="twTitle" content="">
    <meta name="twitter:description" id="twDescription" content="">

    <!-- Theme Color -->
    <meta name="theme-color" content="#d4af37">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap"></noscript>

    <!-- Critical CSS (cache-bust) -->
    <link rel="stylesheet" href="style.css?v=20260221d">

    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://unpkg.com">
    <link rel="dns-prefetch" href="https://images.unsplash.com">

    <!-- Font Awesome + AOS (deferred) -->
    <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" as="style" href="https://unpkg.com/aos@2.3.1/dist/aos.css" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
        <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
    </noscript>
</head>
<body>

    <!-- Navigation -->
    <header>
        <div class="logo" id="siteLogo">...</div>
        <div class="mobile-menu-btn" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </div>
        <nav>
            <ul id="navLinks">
                <li><a href="#home" onclick="closeMobileMenu()">–ù–ê–ß–ê–õ–û</a></li>
                <li><a href="#services" onclick="closeMobileMenu()">–£–°–õ–£–ì–ò</a></li>
                <li><a href="#info" onclick="closeMobileMenu()">–ò–ù–§–û</a></li>
            </ul>
        </nav>
    </header>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <img id="heroLogo" src="" alt="" class="hero-logo" data-aos="zoom-in" width="140" height="140">
        <h1 data-aos="zoom-in" data-aos-delay="200" id="heroTagline"></h1>
        <p data-aos="fade-up" data-aos-delay="300" id="heroDescription"></p>
        
        <!-- Trust Badges -->
        <div class="hero-trust" data-aos="fade-up" data-aos-delay="400">
            <div class="trust-item">
                <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                <span id="heroRating">5.0</span>
            </div>
            <div class="trust-item">
                <i class="fas fa-users"></i>
                <span id="heroReviews">53 –æ—Ç–∑–∏–≤–∞</span>
            </div>
            <div class="trust-item">
                <i class="fas fa-map-marker-alt"></i>
                <span id="heroCity">–ü–ª–æ–≤–¥–∏–≤</span>
            </div>
        </div>

        <!-- Hero Buttons -->
        <div class="hero-buttons" data-aos="fade-up" data-aos-delay="500">
            <button class="btn" onclick="quickBook()"><i class="fas fa-calendar-check"></i> –ó–∞–ø–∞–∑–∏ –ß–∞—Å –°–µ–≥–∞</button>
            <a href="#services" class="btn btn-outline"><i class="fas fa-cut"></i> –£—Å–ª—É–≥–∏ & –¶–µ–Ω–∏</a>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="services">
        <div class="services-header" data-aos="fade-up">
            <span class="section-label"><i class="fas fa-cut"></i> –ö–∞–∫–≤–æ –ø—Ä–µ–¥–ª–∞–≥–∞–º–µ</span>
            <h2 class="section-title">–ù–∞—à–∏—Ç–µ –£—Å–ª—É–≥–∏</h2>
            <div class="title-decoration">
                <span class="line"></span>
                <span class="scissors">‚úÇ</span>
                <span class="line"></span>
            </div>
        </div>
        <div class="service-grid" id="serviceGrid">
            <!-- Services rendered dynamically -->
        </div>
    </section>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>–ó–∞–ø–∞–∑–∏ —á–∞—Å</h2>
            <p id="serviceTitle">–ò–∑–±—Ä–∞–Ω–∞ —É—Å–ª—É–≥–∞: <span id="selectedService"></span></p>

            <!-- Progress Indicator -->
            <div class="booking-progress">
                <div class="progress-step active" data-step="1">
                    <div class="step-circle">1</div>
                    <span class="step-label">–î–∞—Ç–∞</span>
                </div>
                <div class="progress-line" id="progressLine1"></div>
                <div class="progress-step" data-step="2">
                    <div class="step-circle">2</div>
                    <span class="step-label">–ß–∞—Å</span>
                </div>
                <div class="progress-line" id="progressLine2"></div>
                <div class="progress-step" data-step="3">
                    <div class="step-circle">3</div>
                    <span class="step-label">–î–∞–Ω–Ω–∏</span>
                </div>
            </div>

            <div class="booking-container">
                <div class="form-group">
                    <label><i class="fas fa-calendar-alt"></i> –ò–∑–±–µ—Ä–∏ –î–∞—Ç–∞:</label>
                    <div id="dateScroller" class="date-scroller"></div>
                    <input type="hidden" id="datePicker">
                </div>

                <div id="slotsGrid" class="slots-grid">
                    <p class="placeholder-text">–ò–∑–±–µ—Ä–∏ –¥–∞—Ç–∞ –æ—Ç–≥–æ—Ä–µ.</p>
                </div>

                <div id="clientDetails" style="display:none;">
                    <input type="text" id="clientName" placeholder="–¢–≤–æ–µ—Ç–æ –ò–º–µ" required>
                    <input type="tel" id="clientPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–Ω–∞–ø—Ä. 0888123456)" required>
                    <small id="phoneError" style="color: #FF3D71; display: none; margin-bottom: 10px; font-size: 12px;">–ù–µ–≤–∞–ª–∏–¥–µ–Ω —Ç–µ–ª–µ—Ñ–æ–Ω (–Ω–∞–ø—Ä. 0888123456)</small>
                    <div id="blockedMessage" style="display: none; background: rgba(255, 61, 113, 0.15); border: 1px solid rgba(255, 61, 113, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 15px; text-align: center;">
                        <div style="font-size: 28px; margin-bottom: 8px;">üö´</div>
                        <p style="color: #FF5E82; font-weight: 600; margin: 0;">–ù–µ –º–æ–∂–µ—Ç–µ –¥–∞ –∑–∞–ø–∞–∑–∏—Ç–µ —á–∞—Å</p>
                    </div>
                    <input type="email" id="clientEmail" placeholder="Email (–Ω–µ–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ)">
                    <small style="color: #666; display: block; margin-bottom: 15px; font-size: 12px;">–ó–∞ –ø–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ –∏ –Ω–∞–ø–æ–º–Ω—è–Ω–µ</small>
                    <button class="btn" id="submitBtn" onclick="submitBooking()" style="width: 100%; justify-content: center;">
                        <span class="btn-text"><i class="fas fa-paper-plane"></i> –ò–∑–ø—Ä–∞—Ç–∏ –∑–∞—è–≤–∫–∞</span>
                        <span class="btn-loading" style="display: none;"><i class="fas fa-spinner fa-spin"></i> –ò–∑–ø—Ä–∞—â–∞–Ω–µ...</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content success-content">
            <div id="statusPending">
                <div class="status-icon pending-pulse">‚è≥</div>
                <h2>–ó–∞—è–≤–∫–∞—Ç–∞ –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∞!</h2>
                <p>–û—á–∞–∫–≤–∞–º–µ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ...</p>
                <div class="confirmation-box">
                    <p>–í–∞—à–∏—è—Ç –∫–æ–¥:</p>
                    <div class="confirmation-code" id="confirmationCode">-</div>
                </div>
                <div class="auto-refresh-note">
                    <div class="spinner"></div>
                    <span>–ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ...</span>
                </div>
                <p class="success-note">–ú–æ–∂–µ—Ç–µ –¥–∞ –∑–∞—Ç–≤–æ—Ä–∏—Ç–µ —Ç–∞–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞. –©–µ –≤–∏ —É–≤–µ–¥–æ–º–∏–º!</p>
                <button class="btn btn-secondary" onclick="closeSuccess()" style="margin-top: 15px;">–ó–∞—Ç–≤–æ—Ä–∏</button>
            </div>
            <div id="statusConfirmed" style="display: none;">
                <div class="status-icon confirmed-bounce">‚úÖ</div>
                <h2>–ß–∞—Å—ä—Ç –µ –ü–û–¢–í–™–†–î–ï–ù!</h2>
                <div class="booking-details" id="bookingDetails"></div>
                <div class="confirmation-box success-box">
                    <p>–ö–æ–¥ –∑–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è:</p>
                    <div class="confirmation-code" id="confirmationCodeConfirmed">-</div>
                </div>
                <p class="success-note">–û—á–∞–∫–≤–∞–º–µ –≤–∏! üíà</p>
                <button class="btn" onclick="closeSuccess()">–°—Ç—Ä–∞—Ö–æ—Ç–Ω–æ!</button>
            </div>
            <div id="statusRejected" style="display: none;">
                <div class="status-icon">‚ùå</div>
                <h2>–ß–∞—Å—ä—Ç –µ –æ—Ç–∫–∞–∑–∞–Ω</h2>
                <p>–ó–∞ —Å—ä–∂–∞–ª–µ–Ω–∏–µ —Ç–æ–∑–∏ —á–∞—Å –Ω–µ –µ –Ω–∞–ª–∏—á–µ–Ω.</p>
                <p>–ú–æ–ª—è, –∏–∑–±–µ—Ä–µ—Ç–µ –¥—Ä—É–≥ —á–∞—Å –∏–ª–∏ —Å–µ —Å–≤—ä—Ä–∂–µ—Ç–µ —Å –Ω–∞—Å.</p>
                <a id="rejectedPhone" href="#" class="btn"><i class="fas fa-phone"></i> –û–±–∞–¥–∏ —Å–µ</a>
                <button class="btn btn-secondary" onclick="closeSuccess()" style="margin-top: 10px;">–ó–∞—Ç–≤–æ—Ä–∏</button>
            </div>
        </div>
    </div>

    <!-- Info Section -->
    <section id="info" class="info-section">
        <div class="info-container">
            <div class="info-main" data-aos="fade-right">
                <div class="barber-pole"></div>
                <div class="info-main-content">
                    <h2>–ù–∞–º–µ—Ä–∏ –Ω–∏</h2>
                    <div class="location-display">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <span class="district-name" id="infoDistrict"></span>
                            <span class="street-name" id="infoStreet"></span>
                        </div>
                    </div>
                    <div class="rating-display">
                        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <span id="infoRating"></span>
                    </div>
                    <a id="infoDirections" href="#" target="_blank" class="directions-btn">
                        <i class="fas fa-directions"></i> –£–ø—ä—Ç–≤–∞–Ω–µ
                    </a>
                </div>
            </div>

            <div class="info-cards" data-aos="fade-left">
                <div class="info-card">
                    <div class="info-card-icon"><i class="fas fa-clock"></i></div>
                    <div class="info-card-content">
                        <h4>–†–∞–±–æ—Ç–Ω–æ –≤—Ä–µ–º–µ</h4>
                        <div class="hours-list" id="infoHours"></div>
                    </div>
                </div>
                <div class="info-card">
                    <div class="info-card-icon"><i class="fas fa-phone-alt"></i></div>
                    <div class="info-card-content">
                        <h4>–ö–æ–Ω—Ç–∞–∫—Ç–∏</h4>
                        <a id="infoPhone" href="#" class="contact-link">
                            <i class="fas fa-phone"></i> <span id="infoPhoneDisplay"></span>
                        </a>
                    </div>
                </div>
                <div class="info-card">
                    <div class="info-card-icon"><i class="fas fa-share-alt"></i></div>
                    <div class="info-card-content">
                        <h4>–°–æ—Ü–∏–∞–ª–Ω–∏ –º—Ä–µ–∂–∏</h4>
                        <div class="social-links" id="infoSocial"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact CTA -->
    <section id="contact" class="contact">
        <h2 class="section-title">–ó–∞–ø–∞–∑–∏ —Å–≤–æ—è —á–∞—Å</h2>
        <p>–ù–µ —á–∞–∫–∞–π, –º–µ—Å—Ç–∞—Ç–∞ —Å–µ –∑–∞–ø—ä–ª–≤–∞—Ç –±—ä—Ä–∑–æ.</p>
        <div class="hero-buttons" style="justify-content: center;">
            <button class="btn" onclick="quickBook()"><i class="fas fa-calendar-check"></i> –ó–∞–ø–∞–∑–∏ –°–µ–≥–∞</button>
            <a id="ctaPhone" href="#" class="btn btn-outline"><i class="fas fa-phone"></i> <span id="ctaPhoneDisplay"></span></a>
        </div>
    </section>

    <footer>
        <p id="footerText"></p>
    </footer>

    <style>
        /* Inline status/modal styles */
        .status-icon { font-size: 64px; margin-bottom: 15px; }
        .pending-pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        .confirmed-bounce { animation: bounce 0.6s ease-out; }
        @keyframes bounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .auto-refresh-note {
            display: flex; align-items: center; justify-content: center;
            gap: 10px; color: #666; font-size: 13px; margin: 15px 0;
        }
        .spinner {
            width: 14px; height: 14px;
            border: 2px solid #333; border-top-color: #d4af37;
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .booking-details {
            background: rgba(255,255,255,0.03); border-radius: 12px;
            padding: 15px; margin: 15px 0; text-align: left;
        }
        .booking-details .detail-row {
            display: flex; justify-content: space-between;
            padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.06);
        }
        .booking-details .detail-row:last-child { border-bottom: none; }
        .booking-details .label { color: #888; }
        .booking-details .value { color: #fff; font-weight: 600; }
        .success-box { border-color: #00D68F; background: rgba(0, 214, 143, 0.08); }
        .btn-secondary {
            background: transparent; border: 2px solid rgba(212, 175, 55, 0.4);
            color: #d4af37; padding: 13px 38px; border-radius: 50px;
            cursor: pointer; font-size: 14px; font-weight: bold;
            text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s;
        }
        .btn-secondary:hover { background: rgba(212, 175, 55, 0.1); }
        .confirmation-box {
            background: rgba(212, 175, 55, 0.08);
            border: 2px dashed rgba(212, 175, 55, 0.3);
            border-radius: 14px; padding: 20px; margin: 20px 0; text-align: center;
        }
        .confirmation-box p { margin: 0 0 10px; color: #888; font-size: 13px; }
        .confirmation-code {
            font-family: 'Courier New', monospace; font-size: 28px;
            font-weight: bold; color: #d4af37; letter-spacing: 3px; padding: 10px;
        }
        .success-note { color: #666; font-size: 13px; margin-top: 10px; }
        #submitBtn { position: relative; min-width: 180px; }
        #submitBtn:disabled { opacity: 0.6; cursor: not-allowed; }
    </style>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof AOS !== 'undefined') {
                AOS.init({ duration: 700, once: true, offset: 80 });
            } else {
                const waitAOS = setInterval(() => {
                    if (typeof AOS !== 'undefined') {
                        clearInterval(waitAOS);
                        AOS.init({ duration: 700, once: true, offset: 80 });
                    }
                }, 50);
                setTimeout(() => clearInterval(waitAOS), 5000);
            }
        });

        // Header scroll effect
        let lastScroll = 0;
        window.addEventListener('scroll', () => {
            const header = document.querySelector('header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
            lastScroll = window.scrollY;
        });

        let SERVICE_PRICES = {};
        let SITE_CONFIG = null;
        let PHONE_REGEX = /^(\+359|0)8[7-9][0-9]{7}$/;

        // Quick booking - opens modal for featured (or first) service
        function quickBook() {
            if (!SITE_CONFIG) return;
            const featured = SITE_CONFIG.services.find(s => s.featured) || SITE_CONFIG.services[0];
            selectService(featured.name, featured.price);
        }

        async function initFromConfig() {
            try {
                const res = await fetch('/api/config');
                const cfg = await res.json();
                SITE_CONFIG = cfg;

                cfg.services.forEach(s => { SERVICE_PRICES[s.name] = s.price; });

                if (cfg.booking.phoneRegex) {
                    PHONE_REGEX = new RegExp(cfg.booking.phoneRegex);
                }

                // SEO
                document.getElementById('pageTitle').textContent = cfg.seo.title;
                document.getElementById('metaDescription').content = cfg.seo.description;
                document.getElementById('metaKeywords').content = cfg.seo.keywords;
                document.getElementById('metaAuthor').content = cfg.business.name;
                document.getElementById('ogTitle').content = cfg.seo.title;
                document.getElementById('ogDescription').content = cfg.business.description;
                document.getElementById('ogImage').content = '/' + cfg.theme.logo;
                document.getElementById('ogUrl').content = cfg.seo.ogUrl;
                document.getElementById('ogSiteName').content = cfg.business.name;
                document.getElementById('twTitle').content = cfg.seo.title;
                document.getElementById('twDescription').content = cfg.business.description;

                // Header
                document.getElementById('siteLogo').textContent = cfg.business.shortName;

                // Hero
                document.getElementById('heroLogo').src = cfg.theme.logo;
                document.getElementById('heroLogo').alt = cfg.business.name + ' Logo';
                const words = cfg.business.tagline.split(' ');
                const lastWord = words.pop();
                document.getElementById('heroTagline').innerHTML = words.join(' ') + ' <span>' + lastWord + '</span>';
                document.getElementById('heroDescription').textContent = cfg.business.description;

                // Hero trust badges
                document.getElementById('heroRating').textContent = cfg.business.rating.score;
                document.getElementById('heroReviews').textContent = cfg.business.rating.count + ' –æ—Ç–∑–∏–≤–∞';
                document.getElementById('heroCity').textContent = cfg.business.address.city;

                // Hero background
                document.querySelector('.hero').style.background = 
                    'linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.85)), url(\'' + cfg.theme.heroImage + '\')';
                document.querySelector('.hero').style.backgroundSize = 'cover';
                document.querySelector('.hero').style.backgroundPosition = 'center';

                // Services
                const grid = document.getElementById('serviceGrid');
                grid.innerHTML = '';
                cfg.services.forEach((svc, i) => {
                    const card = document.createElement('div');
                    card.className = 'service-card' + (svc.featured ? ' featured' : '');
                    card.setAttribute('data-aos', 'fade-up');
                    card.setAttribute('data-aos-delay', (i * 100).toString());
                    card.onclick = () => selectService(svc.name, svc.price);
                    card.innerHTML = (svc.featured ? '<div class="featured-badge"><i class="fas fa-star"></i> –ü—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–æ</div>' : '') +
                        '<div class="service-icon"><i class="' + svc.icon + '"></i></div>' +
                        '<h3>' + svc.name + '</h3>' +
                        '<p>' + svc.description + '</p>' +
                        '<div class="service-footer">' +
                            '<span class="price">' + svc.price + ' ' + cfg.booking.currency + '</span>' +
                            '<button class="book-btn">–ó–∞–ø–∞–∑–∏</button>' +
                        '</div>';
                    grid.appendChild(card);
                });

                // Info section
                document.getElementById('infoDistrict').textContent = cfg.business.address.district + ', ' + cfg.business.address.city;
                document.getElementById('infoStreet').textContent = cfg.business.address.street;
                document.getElementById('infoRating').textContent = cfg.business.rating.score + ' –æ—Ç ' + cfg.business.rating.count + ' –æ—Ç–∑–∏–≤–∞';
                document.getElementById('infoDirections').href = 'https://www.google.com/maps/search/?api=1&query=' + cfg.business.address.googleMapsQuery;

                // Work hours with today highlight
                const hoursList = document.getElementById('infoHours');
                hoursList.innerHTML = '';
                const dayNames = ['–ù–µ–¥', '–ü–æ–Ω', '–í—Ç–æ', '–°—Ä—è', '–ß–µ—Ç', '–ü–µ—Ç', '–°—ä–±'];
                const todayShort = dayNames[new Date().getDay()];
                
                cfg.workHours.display.forEach(h => {
                    const row = document.createElement('div');
                    const isToday = h.days.includes(todayShort) || 
                        (todayShort === '–ü–æ–Ω' && h.days.includes('–ü–æ–Ω')) ||
                        (todayShort === '–°—ä–±' && h.days.includes('–°—ä–±–æ—Ç–∞')) ||
                        (todayShort === '–ù–µ–¥' && h.days.includes('–ù–µ–¥–µ–ª—è'));
                    
                    row.className = 'hour-row' + 
                        (h.closed ? ' closed' : '') + 
                        (h.break ? ' break' : '') +
                        (isToday ? ' today' : '');
                    row.innerHTML = '<span>' + h.days + (isToday ? ' üìç' : '') + '</span><span class="hour-time">' + h.hours + '</span>';
                    hoursList.appendChild(row);
                });

                // Phone
                document.getElementById('infoPhone').href = 'tel:' + cfg.business.phone;
                document.getElementById('infoPhoneDisplay').textContent = cfg.business.phoneDisplay;
                document.getElementById('ctaPhone').href = 'tel:' + cfg.business.phone;
                document.getElementById('ctaPhoneDisplay').textContent = cfg.business.phoneDisplay;
                document.getElementById('rejectedPhone').href = 'tel:' + cfg.business.phone;

                // Social
                const socialEl = document.getElementById('infoSocial');
                socialEl.innerHTML = '';
                const socials = cfg.business.social || {};
                if (socials.instagram && socials.instagram !== '#') socialEl.innerHTML += '<a href="' + socials.instagram + '" target="_blank" rel="noopener" class="social-btn instagram" title="Instagram"><i class="fab fa-instagram"></i></a>';
                if (socials.facebook && socials.facebook !== '#') socialEl.innerHTML += '<a href="' + socials.facebook + '" target="_blank" rel="noopener" class="social-btn facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>';
                if (socials.tiktok && socials.tiktok !== '#') socialEl.innerHTML += '<a href="' + socials.tiktok + '" target="_blank" rel="noopener" class="social-btn tiktok" title="TikTok"><i class="fab fa-tiktok"></i></a>';
                if (socials.github) socialEl.innerHTML += '<a href="' + socials.github + '" target="_blank" rel="noopener" class="social-btn github" title="GitHub"><i class="fab fa-github"></i></a>';

                // Footer
                document.getElementById('footerText').innerHTML = '&copy; ' + cfg.business.year + ' ' + cfg.business.name + '. –í—Å–∏—á–∫–∏ –ø—Ä–∞–≤–∞ –∑–∞–ø–∞–∑–µ–Ω–∏.';

                // Theme
                document.documentElement.style.setProperty('--primary-color', cfg.theme.primaryColor);

                // Setup inline phone validation
                setupPhoneValidation();

            } catch (e) {
                console.error('Failed to load config:', e);
            }
        }

        initFromConfig();

        // ========== Phone Validation (Real-time) ==========
        function setupPhoneValidation() {
            const phoneInput = document.getElementById('clientPhone');
            phoneInput.addEventListener('input', function() {
                const phone = this.value.trim().replace(/\s/g, '');
                const errorEl = document.getElementById('phoneError');
                
                if (phone.length === 0) {
                    this.classList.remove('input-valid', 'input-invalid');
                    errorEl.style.display = 'none';
                } else if (PHONE_REGEX.test(phone)) {
                    this.classList.add('input-valid');
                    this.classList.remove('input-invalid');
                    errorEl.style.display = 'none';
                } else {
                    this.classList.remove('input-valid');
                    if (phone.length >= 4) {
                        this.classList.add('input-invalid');
                        errorEl.style.display = 'block';
                    }
                }
            });
        }

        // ========== Toast Notifications ==========
        function showToast(message, type = 'success') {
            const icons = { success: '‚úì', error: '‚úó', info: '‚Ñπ' };
            const toast = document.createElement('div');
            toast.className = 'toast toast-' + type;
            toast.innerHTML = '<div class="toast-icon">' + (icons[type] || icons.info) + '</div><span>' + message + '</span>';
            document.body.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 50);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ========== Progress Indicator ==========
        function updateProgress(step) {
            document.querySelectorAll('.progress-step').forEach((el, idx) => {
                const s = idx + 1;
                el.classList.remove('active', 'completed');
                if (s < step) el.classList.add('completed');
                else if (s === step) el.classList.add('active');
            });
            // Lines
            const line1 = document.getElementById('progressLine1');
            const line2 = document.getElementById('progressLine2');
            if (line1) line1.className = 'progress-line' + (step > 1 ? ' active' : '');
            if (line2) line2.className = 'progress-line' + (step > 2 ? ' active' : '');
        }

        // ========== Mobile Menu ==========
        function toggleMobileMenu() {
            document.getElementById('navLinks').classList.toggle('active');
        }

        function closeMobileMenu() {
            document.getElementById('navLinks').classList.remove('active');
        }

        // ========== Booking Logic ==========
        const modal = document.getElementById("bookingModal");
        let currentService = "";
        let currentPrice = 0;
        let selectedTime = null;

        function selectService(name, price) {
            currentService = name;
            currentPrice = price;
            document.getElementById("selectedService").innerText = name + " (" + price + " –ª–≤.)";
            modal.style.display = "block";
            document.getElementById("datePicker").value = new Date().toISOString().split('T')[0];
            generateDates();
            updateProgress(1);
        }

        function generateDates() {
            const scroller = document.getElementById("dateScroller");
            scroller.innerHTML = "";
            const days = ['–ù–µ–¥', '–ü–æ–Ω', '–í—Ç–æ', '–°—Ä—è', '–ß–µ—Ç', '–ü–µ—Ç', '–°—ä–±'];
            const months = ['–Ø–Ω—É', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π', '–Æ–Ω–∏', '–Æ–ª–∏', '–ê–≤–≥', '–°–µ–ø', '–û–∫—Ç', '–ù–æ–µ', '–î–µ–∫'];

            for(let i=0; i<14; i++) {
                const d = new Date();
                d.setDate(d.getDate() + i);
                const isoDate = d.toISOString().split('T')[0];
                const dayName = i === 0 ? "–î–Ω–µ—Å" : i === 1 ? "–£—Ç—Ä–µ" : days[d.getDay()];

                const card = document.createElement("div");
                card.className = "date-card";
                if(i===0) card.classList.add("active");
                card.onclick = () => selectDate(card, isoDate);
                card.innerHTML = '<span class="day-name">' + dayName + '</span>' +
                    '<span class="day-number">' + d.getDate() + '</span>' +
                    '<span class="month-name">' + months[d.getMonth()] + '</span>';
                scroller.appendChild(card);

                if(i===0) {
                    document.getElementById("datePicker").value = isoDate;
                    loadSlots();
                }
            }
        }

        function selectDate(el, date) {
            document.querySelectorAll(".date-card").forEach(c => c.classList.remove("active"));
            el.classList.add("active");
            document.getElementById("datePicker").value = date;
            loadSlots();
            updateProgress(1);
        }

        function closeModal() {
            modal.style.display = "none";
            document.getElementById("clientDetails").style.display = "none";
            document.getElementById("clientName").value = "";
            document.getElementById("clientPhone").value = "";
            document.getElementById("clientPhone").classList.remove('input-valid', 'input-invalid');
            document.getElementById("clientEmail").value = "";
            document.getElementById("clientEmail").style.display = "";
            document.getElementById("clientEmail").nextElementSibling.style.display = "";
            document.getElementById("blockedMessage").style.display = "none";
            document.getElementById("submitBtn").style.display = "";
            document.getElementById("phoneError").style.display = "none";
            selectedTime = null;
            updateProgress(1);
        }

        let statusCheckTimeout = null;
        let currentBookingCode = null;
        let pollCount = 0;
        const POLL_INTERVALS = [3, 5, 5, 10, 10, 15, 15, 30];

        function closeSuccess() {
            document.getElementById("successModal").style.display = "none";
            if (statusCheckTimeout) { clearTimeout(statusCheckTimeout); statusCheckTimeout = null; }
            pollCount = 0;
            document.getElementById("statusPending").style.display = "block";
            document.getElementById("statusConfirmed").style.display = "none";
            document.getElementById("statusRejected").style.display = "none";
        }

        function showBookingStatus(code, bookingData) {
            currentBookingCode = code;
            document.getElementById("confirmationCode").innerText = code;
            document.getElementById("successModal").style.display = "block";
            pollCount = 0;
            checkStatus(code, bookingData);
        }

        function scheduleNextPoll(code, bookingData) {
            const interval = POLL_INTERVALS[Math.min(pollCount, POLL_INTERVALS.length - 1)] * 1000;
            pollCount++;
            statusCheckTimeout = setTimeout(() => {
                if (document.hidden) {
                    const onVisible = () => {
                        document.removeEventListener('visibilitychange', onVisible);
                        checkStatus(code, bookingData);
                    };
                    document.addEventListener('visibilitychange', onVisible);
                } else {
                    checkStatus(code, bookingData);
                }
            }, interval);
        }

        async function checkStatus(code, bookingData) {
            try {
                const res = await fetch('/api/status/' + code + '?t=' + Date.now(), { cache: 'no-store' });
                if (!res.ok) { scheduleNextPoll(code, bookingData); return; }
                const data = await res.json();

                if (data.status === 'confirmed') {
                    document.getElementById("statusPending").style.display = "none";
                    document.getElementById("statusConfirmed").style.display = "block";
                    document.getElementById("confirmationCodeConfirmed").innerText = code;
                    document.getElementById("bookingDetails").innerHTML = 
                        '<div class="detail-row"><span class="label">üìÖ –î–∞—Ç–∞</span><span class="value">' + formatDateBg(data.date) + '</span></div>' +
                        '<div class="detail-row"><span class="label">‚è∞ –ß–∞—Å</span><span class="value">' + data.time + '</span></div>' +
                        '<div class="detail-row"><span class="label">‚úÇÔ∏è –£—Å–ª—É–≥–∞</span><span class="value">' + data.service + '</span></div>';
                } else if (data.status === 'rejected') {
                    document.getElementById("statusPending").style.display = "none";
                    document.getElementById("statusRejected").style.display = "block";
                } else {
                    scheduleNextPoll(code, bookingData);
                }
            } catch (e) {
                scheduleNextPoll(code, bookingData);
            }
        }

        function formatDateBg(dateStr) {
            const date = new Date(dateStr);
            const days = ['–ù–µ–¥–µ–ª—è', '–ü–æ–Ω–µ–¥–µ–ª–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä—è–¥–∞', '–ß–µ—Ç–≤—ä—Ä—Ç—ä–∫', '–ü–µ—Ç—ä–∫', '–°—ä–±–æ—Ç–∞'];
            const months = ['—è–Ω—É–∞—Ä–∏', '—Ñ–µ–≤—Ä—É–∞—Ä–∏', '–º–∞—Ä—Ç', '–∞–ø—Ä–∏–ª', '–º–∞–π', '—é–Ω–∏', '—é–ª–∏', '–∞–≤–≥—É—Å—Ç', '—Å–µ–ø—Ç–µ–º–≤—Ä–∏', '–æ–∫—Ç–æ–º–≤—Ä–∏', '–Ω–æ–µ–º–≤—Ä–∏', '–¥–µ–∫–µ–º–≤—Ä–∏'];
            return days[date.getDay()] + ', ' + date.getDate() + ' ' + months[date.getMonth()];
        }

        async function loadSlots() {
            const date = document.getElementById("datePicker").value;
            if (!date) return;

            const grid = document.getElementById("slotsGrid");
            grid.innerHTML = "<p>–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</p>";
            updateProgress(1);

            try {
                const res = await fetch('/api/slots?date=' + date);
                const slots = await res.json();
                grid.innerHTML = "";

                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];
                const isToday = date === todayStr;

                const availableSlots = slots.filter(slot => {
                    if (!isToday) return true;
                    const [h, m] = slot.time.split(':').map(Number);
                    if (h < today.getHours()) return false;
                    if (h === today.getHours() && m <= today.getMinutes()) return false;
                    return true;
                });

                if(availableSlots.length === 0) {
                    grid.innerHTML = "<p>–ù—è–º–∞ —Å–≤–æ–±–æ–¥–Ω–∏ —á–∞—Å–æ–≤–µ –∑–∞ —Ç–∞–∑–∏ –¥–∞—Ç–∞.</p>";
                    return;
                }

                availableSlots.forEach(slot => {
                    const div = document.createElement("div");
                    if (slot.status === 'free') {
                        div.className = "time-slot free";
                        div.innerText = slot.time;
                        div.onclick = () => selectTime(div, slot.time);
                    } else {
                        div.className = "time-slot taken";
                        div.innerText = slot.time;
                        div.title = slot.status === 'confirmed' ? "–ó–∞–µ—Ç" : "–ò–∑—á–∞–∫–≤–∞";
                    }
                    grid.appendChild(div);
                });

                // After loading slots, update progress to step 2
                updateProgress(2);

            } catch (e) {
                grid.innerHTML = "<p>–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—Ä—ä–∑–∫–∞ —Å—ä—Å —Å—ä—Ä–≤—ä—Ä–∞.</p>";
            }
        }

        function selectTime(el, time) {
            document.querySelectorAll('.time-slot.selected').forEach(d => d.classList.remove('selected'));
            el.classList.add('selected');
            selectedTime = time;
            document.getElementById("clientDetails").style.display = "block";
            updateProgress(3);
            // Smooth scroll to form
            setTimeout(() => {
                document.getElementById("clientName").scrollIntoView({ behavior: 'smooth', block: 'center' });
                document.getElementById("clientName").focus();
            }, 150);
        }

        function validateInput(id, regex) {
            const el = document.getElementById(id);
            const valid = regex ? regex.test(el.value.trim().replace(/\s/g, '')) : el.value.trim().length > 0;
            if (!valid) {
                el.classList.add('input-invalid');
            } else {
                el.classList.remove('input-invalid');
            }
            if(id === "clientPhone") {
                document.getElementById("phoneError").style.display = valid ? "none" : "block";
            }
            return valid;
        }

        async function submitBooking() {
            const nameValid = validateInput("clientName");
            const phoneValid = validateInput("clientPhone", PHONE_REGEX);

            if (!nameValid || !phoneValid || !selectedTime) {
                if(!selectedTime) showToast('–ú–æ–ª—è –∏–∑–±–µ—Ä–µ—Ç–µ —á–∞—Å!', 'error');
                return;
            }

            const name = document.getElementById("clientName").value;
            const phone = document.getElementById("clientPhone").value.trim().replace(/\s/g, '');
            const email = document.getElementById("clientEmail").value.trim();
            const date = document.getElementById("datePicker").value;
            const btn = document.getElementById('submitBtn');

            btn.disabled = true;
            btn.querySelector('.btn-text').style.display = 'none';
            btn.querySelector('.btn-loading').style.display = 'inline-flex';

            try {
                const price = SERVICE_PRICES[currentService] || currentPrice;
                const res = await fetch('/api/book', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ date, time: selectedTime, service: currentService, price, clientName: name, clientPhone: phone, clientEmail: email || null })
                });

                const data = await res.json();

                if (res.ok) {
                    closeModal();
                    showBookingStatus(data.confirmationCode, { date, time: selectedTime, service: currentService });
                    showToast('–ó–∞—è–≤–∫–∞—Ç–∞ –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∞!', 'success');
                } else if (data.error === 'blocked') {
                    document.getElementById('blockedMessage').style.display = 'block';
                    document.getElementById('submitBtn').style.display = 'none';
                    document.getElementById('clientEmail').style.display = 'none';
                    document.getElementById('clientEmail').nextElementSibling.style.display = 'none';
                } else {
                    showToast(data.error || '–í—ä–∑–Ω–∏–∫–Ω–∞ –ø—Ä–æ–±–ª–µ–º', 'error');
                    loadSlots();
                }
            } catch (e) {
                showToast('–°—ä—Ä–≤—ä—Ä–Ω–∞ –≥—Ä–µ—à–∫–∞', 'error');
            }

            btn.disabled = false;
            btn.querySelector('.btn-text').style.display = 'inline-flex';
            btn.querySelector('.btn-loading').style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target == modal) closeModal();
        }

        // Scroll spy
        const sections = document.querySelectorAll('section[id]');
        const navLinksAll = document.querySelectorAll('nav a');

        function highlightNav() {
            const scrollY = window.scrollY;
            sections.forEach(section => {
                const top = section.offsetTop - 100;
                const height = section.offsetHeight;
                const id = section.getAttribute('id');
                if (scrollY >= top && scrollY < top + height) {
                    navLinksAll.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === '#' + id) link.classList.add('active');
                    });
                }
            });
        }

        window.addEventListener('scroll', highlightNav);
        highlightNav();
    </script>
</body>
</html>
